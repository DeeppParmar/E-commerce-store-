Supabase Setup Guide for "Dumbo" (E-commerce-store-)
======================================================
This guide helps you set up your Supabase project from scratch.

STEP 1: Create a Supabase Account & Project
-------------------------------------------
1. Go to https://supabase.com/ and click "Start your project".
2. Sign up with GitHub (recommended) or email.
3. Click "New Project".
4. Choose your Organization (or create one).
5. Enter a Name: "dumbo-store" (or similar).
6. Set a Database Password (SAVE THIS PASSWORD! You will need it later).
7. Select a Region close to you (e.g., Singapore, Frankfurt, US East).
8. Click "Create new project".
   - It will take a few minutes to provision the database.

STEP 2: Get API Keys & URL
--------------------------
1. Once the project is ready, go to the project dashboard.
2. Navigate to "Project Settings" (icon at the bottom of the left sidebar).
3. Click on "API".
4. Copy the "Project URL" -> This is your SUPABASE_URL.
5. Copy the "anon" "public" key -> This is your SUPABASE_ANON_KEY (for Frontend).
6. Copy the "service_role" "secret" key -> This is your SUPABASE_SERVICE_ROLE_KEY (for Backend).

   > SAVE THESE KEYS! You will put them in your .env files.

STEP 3: Set Up Database Tables (Run SQL)
----------------------------------------
1. On the left sidebar, click the "SQL Editor" icon (looks like a terminal `>_`).
2. Click "New query".
3. Copy and paste the ENTIRE SQL script below into the editor.
4. Click "Run" (bottom right of the editor).

--- COPY BELOW THIS LINE ---

-- Enable UUID extension
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- PROFILES (Extends Supabase Auth)
CREATE TABLE public.profiles (
  id UUID REFERENCES auth.users(id) ON DELETE CASCADE PRIMARY KEY,
  email TEXT NOT NULL,
  full_name TEXT,
  avatar_url TEXT,
  role TEXT DEFAULT 'user' CHECK (role IN ('user', 'seller', 'admin')),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- AUCTIONS
CREATE TABLE public.auctions (
  id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
  seller_id UUID REFERENCES public.profiles(id) NOT NULL,
  title TEXT NOT NULL,
  description TEXT,
  images TEXT[] DEFAULT '{}',
  starting_price DECIMAL(12, 2) NOT NULL,
  current_price DECIMAL(12, 2) NOT NULL DEFAULT 0,
  start_time TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  end_time TIMESTAMPTZ NOT NULL,
  status TEXT DEFAULT 'active' CHECK (status IN ('active', 'ended', 'cancelled')),
  winner_id UUID REFERENCES public.profiles(id),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- BIDS
CREATE TABLE public.bids (
  id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
  auction_id UUID REFERENCES public.auctions(id) ON DELETE CASCADE NOT NULL,
  bidder_id UUID REFERENCES public.profiles(id) NOT NULL,
  amount DECIMAL(12, 2) NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- AUCTION PARTICIPANTS (Watchlist / Joined)
CREATE TABLE public.auction_participants (
  auction_id UUID REFERENCES public.auctions(id) ON DELETE CASCADE NOT NULL,
  user_id UUID REFERENCES public.profiles(id) ON DELETE CASCADE NOT NULL,
  joined_at TIMESTAMPTZ DEFAULT NOW(),
  PRIMARY KEY (auction_id, user_id)
);

-- INDEXES
CREATE INDEX idx_auctions_status ON public.auctions(status);
CREATE INDEX idx_auctions_end_time ON public.auctions(end_time);
CREATE INDEX idx_bids_auction_id ON public.bids(auction_id);
CREATE INDEX idx_bids_bidder_id ON public.bids(bidder_id);

-- RLS POLICIES (Row Level Security)
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.auctions ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.bids ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.auction_participants ENABLE ROW LEVEL SECURITY;

-- Profiles: Public read, User update own
CREATE POLICY "Public profiles are viewable by everyone" ON public.profiles FOR SELECT USING (true);
CREATE POLICY "Users can update own profile" ON public.profiles FOR UPDATE USING (auth.uid() = id);
CREATE POLICY "Users can insert their own profile" ON public.profiles FOR INSERT WITH CHECK (auth.uid() = id);

-- Auctions: Public read, Seller create/update own
CREATE POLICY "Auctions are viewable by everyone" ON public.auctions FOR SELECT USING (true);
CREATE POLICY "Sellers can create auctions" ON public.auctions FOR INSERT WITH CHECK (auth.uid() = seller_id);
CREATE POLICY "Sellers can update own auctions" ON public.auctions FOR UPDATE USING (auth.uid() = seller_id);

-- Bids: Public read, Authenticated create
CREATE POLICY "Bids are viewable by everyone" ON public.bids FOR SELECT USING (true);
CREATE POLICY "Authenticated users can place bids" ON public.bids FOR INSERT WITH CHECK (auth.uid() = bidder_id);

-- TRIGGER: Update timestamp
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ language 'plpgsql';

CREATE TRIGGER update_profiles_updated_at BEFORE UPDATE ON public.profiles FOR EACH ROW EXECUTE PROCEDURE update_updated_at_column();
CREATE TRIGGER update_auctions_updated_at BEFORE UPDATE ON public.auctions FOR EACH ROW EXECUTE PROCEDURE update_updated_at_column();

-- TRIGGER: Automatic Profile Creation on Sign Up
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS TRIGGER AS $$
BEGIN
  INSERT INTO public.profiles (id, email, full_name, avatar_url)
  VALUES (new.id, new.email, new.raw_user_meta_data->>'full_name', new.raw_user_meta_data->>'avatar_url');
  RETURN new;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW EXECUTE FUNCTION public.handle_new_user();

--- END SQL SCRIPT ---

STEP 4: Authentication Settings
-------------------------------
1. Go to "Authentication" -> "Providers" (left sidebar).
2. "Email" should be enabled by default.
3. Ensure "Confirm email" is disabled for development (optional, makes testing easier) or configure your SMTP settings if you want real email verification.
   - To disable email confirmation: Go to Auth -> Providers -> Email -> Turn OFF "Confirm email".

STEP 5: Connect to Your App
---------------------------
Now copy the keys you saved in Step 2 into your .env files:

Backend/.env:
SUPABASE_URL=...
SUPABASE_SERVICE_ROLE_KEY=...

Frontend/.env:
VITE_SUPABASE_URL=...
VITE_SUPABASE_ANON_KEY=...

You resolve "Done! Your backend and frontend are now connected to your new Supabase project."
